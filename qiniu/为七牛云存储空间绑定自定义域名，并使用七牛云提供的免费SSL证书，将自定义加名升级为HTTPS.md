为七牛云存储空间绑定自定义域名，并使用七牛云提供的免费SSL证书，将自定义加名升级为HTTPS
---

## 〇、七牛将定期回收测试域名，正在使用测试域名的小伙伴们必须设置自定义域名了

想必最近很多小伙伴都收到了这封来自七牛云的邮件，这意味着创建七牛云空间时附带自动生成的域名每30日就会变更一次，再也无法长期使用。
现在我们必须给七牛云空间绑定一个自己的域名。

> 尊敬的七牛云用户，您好:    
如果您正在使用或将要使用测试域名，请务必仔细阅读本邮件内容！
七牛云测试域名是用户在创建云存储空间时系统自动生成的七牛域名，以 clouddn.com, qiniucdn.com, qiniudn.com, qnssl.com, qbox.me 等结尾，此类域名仅供用户测试不能用于正式生产环境。测试域名不规范使用或被当作正式域名使用，将导致域名的安全风险增加，从而影响用户的正常测试需求。
为了确保测试域名的规范使用，保障七牛云用户的权益，我们将逐步对测试域名加强管理，具体规则如下：  
> 1.【已上线生效】  
不得使用测试域名存储、发布、传播违法违规内容。当测试域名下有非法资源时，该域名将被直接冻结并不予解封。如对七牛云及其他用户造成损害，七牛云保留进一步追责的权利。  
对2018年7月18日起新产生的测试域名，禁止下载移动应用程序(apk,ipa等)，请绑定自定义域名进行访问。    
> 2.【预计生效时间8月上旬】：流量限制  
测试域名无论新老测试域名每个自然日限总流量10GB，当日测试流量达到10GB上限后，禁止继续访问。    
> 3.【预计生效时间8月中旬】：测试域名回收机制  
每个测试域名生命周期为30个自然日（已有测试域名自回收功能上线之日起算，新产生的测试域名自系统自动生成之日起算），超过30日系统将自动回收，回收即为域名删除。  
在测试域名生命周期终结之前我们会邮件通知您，您也可以自行在 七牛云-管理控制台 上查看测试域名剩余的回收时间。  
上述每个功能正式上线前我们都将在七牛云平台上发布公告，请您及时留意 七牛云-管理控制台。为了您的正常业务不受影响，请您规范使用测试域名，并尽快绑定自定义域名进行访问（如已绑定，请忽略）。  
感谢您使用七牛云，如果您有任何疑问，您可以点击提交工单联系和反馈给我们。  
此致     
七牛云团队  
2018.07  


## 一、准备工作

1. 首先要有一个七牛存储空间。
2. 七牛云的账户余额应该大于10元（账户余额大于10元才允许绑定自定义域名）。
3. 要有一个域名。

## 二、为七牛云空间绑定自定义加速域名

### 1. 登录七牛云的管理控制台 ->选择对象存储->在存储空间列表中选择想要绑定域名的存储空间
![管理控制台 ->对象存储->选择存储空间](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_153539.jpg)

### 2. 在存储空间的空间概览中找到“融合 CDN 加速域名”栏，点击右侧自定义域名
![空间概览->融合 CDN 加速域名->自定义域名](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_154153.jpg)

### 3. 在创建域名页面，填写加速域名，其他选项根据需求填写，点击创建。
![填写加速域名](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_155808.jpg)

### 4. 保存成功后，会得到加速域名对应的 CNAME
![加速域名对应的 CNAME](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_155946.jpg)
关于CNAME是什么，可查看[如何配置域名的 CNAME](https://developer.qiniu.com/fusion/kb/1322/how-to-configure-cname-domain-name)

### 5. 登录域名服务商（这里以阿里云为例）的控制台，添加域名解析
![添加域名解析](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_160149.jpg)

### 6. 记录类型选择CNAME，主机记录和记录值根据第（4）步得到的加速域名和CNAME填写，保存
![添加域名解析记录](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_160234.jpg)

![保存后的域名解析记录](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_160253.jpg)

### 7. 保存后回到七牛存储空间的控制台，可以看到加速域名绑定状态为处理中，最久需要三小时
![加速域名绑定](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_160331.jpg)

### 8. 加速域名绑定成功时，会收到邮件提醒
![邮件提醒](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_164223.jpg)

![加速域名绑定成功](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_164007.jpg)

### 9. 选择内容管理，外链默认域名选择刚刚设置的自定义域名，点击保存默认域名
![保存默认域名](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_164459.jpg)

### 10. 此时点击预览，资源的链接已经替换成了刚刚设置的自定义域名
![点击预览](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_164833.jpg)


## 三、使用七牛云免费的SSL证书，将自定义加速域名升级为HTTPS

> 现在提倡全站HTTPS，因此，将访问静态资源的七牛云地址升级为https也是很有必要的。

### 1. 登录七牛云的控制台->选择SSL证书服务->点击购买证书
![SSL证书服务](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_170039.jpg)

### 2. 选择限免的证书，点击核对信息并支付，支付成功后点击补全信息
![选择限免的证书，点击核对信息并支付](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_172413.jpg)

![补全信息](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_172537.jpg)

### 3. 填写要申请SSL证书的域名信息，并按要求填写公司信息和联系人（授权代表）信息
![填写要申请SSL证书的域名信息](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_172842.jpg)

### 4. 填写完成并提交后，回到证书列表页，可以查看证书状态为待确认，点击详情
![证书状态为待确认](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_181553.jpg)

### 5. 在证书的详情页，可以看到TXT记录名和TXT记录值
![证书详情页](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_181737.jpg)

### 6. 登录域名服务商（这里以阿里云为例）的控制台，添加域名解析
![添加域名解析](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_160149.jpg)

### 7. 记录类型选择TXT，主机记录和记录值根据第（5）步得到的TXT记录名和TXT记录值填写，保存
![添加域名解析记录](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_181854.jpg)

TXT Key 的 DNS 解析指向 TXT Value 操作完成后，系统会循环自动检测验证，期间需要耐心等待，最长不超过24小时。[免费证书验证指南](https://developer.qiniu.com/ssl/manual/3667/ssl-certificate-of-free-dns-validation-guide)

### 8. 当验证成功后，SSL证书的订单状态会变为已签发，证书有效期为1年
![SSL证书申请成功](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_190816.jpg)

### 9. 回到对象存储->在存储空间列表中选择之前绑定域名的存储空间->融合 CDN 加速域名->点击要升级为HTTPS访问的域名
![点击要升级为HTTPS访问的域名](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_191227.jpg)

### 10. 在域名管理页找到HTTPS配置，点击修改配置
![HTTPS配置](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_191603.jpg)

### 11. 勾选HTTPS，选择刚刚购买的SSL证书，开启强制HTTPS访问（当用户通过HTTP方式访问七牛资源时，会自动重定向到HTTPS）
![HTTPS配置修改](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_191733.jpg)

### 12. 回到对象存储->在存储空间列表中选择之前绑定域名的存储空间->融合 CDN 加速域名->刚刚配置了HTTPS的域名的状态为处理中，需要等待一段时间，当域名状态变为成功时，即可使用HTTPS方式访问七牛空间资源
![](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_192242.jpg)

### 13. 当域名状态变为成功时，进入存储空间的内容管理，点击预览，资源的链接的协议已经替换成了HTTPS
![](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_192817.jpg)

![点击预览](http://md.ws65535.top/xsj/2018_8_6_2018-08-06_192735.jpg)
